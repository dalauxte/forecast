# Review – Anforderungen, Architektur, Manual vs. Implementierung (MVP)

Rolle: Reviewer-Agent. Ziel: Abgleich der Dokumente mit dem aktuellen Code-Stand.

## Zusammenfassung
- Kernfunktionalität (Konfig, Kalender, Kapazität, Verteilung, Berechnung, CSV-Export) ist implementiert und entspricht weitgehend den Anforderungen.
- Einige Abweichungen/Feinheiten sollten adressiert werden (s. „Findings“).

## Positiv / Abdeckung
- YAML-Config zentral, Default-Pfad `config/config.yml` (CLI optionales `--config`).
- Feiertage (NI) via `python-holidays`, Urlaub/Overrides werden berücksichtigt.
- Kapazität: `per_weekday` + `interval_overrides`, Krankheitsreduktion via Erwartungswert.
- Monatsgewichte inkl. Gleichverteilung bei fehlenden Angaben; Summe > 100% wird validiert.
- Berechnung: Øh/Tag für 100/90/80 (Rundung 0.15 h), Auslastung relativ zur zugeordneten Kapazität, Umsatz 100/90/80.
- Ausgabe: CLI-Tabelle + CSV in `output/` mit Zeitstempel; DE-Zahlenformat (Komma als Dezimalzeichen).

## Findings (Abweichungen / Risiken)
1) Stichtag/As-Of: In Anforderungen erwähnt, CLI-Flag vorhanden, aber im Code ungenutzt. Die Berechnung basiert allein auf `planning_period`.
   - Empfehlung: `as_of` berücksichtigen (Arbeitstage < as_of ausschließen oder `planning_period.start = max(planning_period.start, as_of)`).

2) Feiertage-API: Verwendung `holidays.Germany(..., prov="NI")` kann versionsabhängig sein; in neueren Versionen ist `subdiv="NI"` üblich.
   - Risiko: Falsy-Leerresultat bei falschem Parameternamen → Feiertage nicht berücksichtigt.
   - Empfehlung: Robust machen: try `subdiv`, fallback `prov`, inkl. Test.

3) Warnungen/Edge Cases: Anforderungen sehen Hinweise/Warnungen vor (z. B. 0 verbleibende Tage/Kapazität). Aktuell werden Projekte ohne Arbeitstage still ignoriert.
   - Empfehlung: Sammeln und Ausgeben von Warnungen (z. B. am Ende eine Liste „Ignorierte Projekte (Grund)“).

4) Auslastung nur 100%: Tabelle zeigt „Util 100%“. Anforderungen nennen Auslastung 100/90/80.
   - Empfehlung: Spalten „Util 90%“ und „Util 80%“ ergänzen (CLI + CSV).

5) Gesamtzeile/Summen: Anforderungen nennen eine Gesamtzeile (Summe Kapazität (h), Summe Umsatz). Aktuell fehlt eine Gesamtzeile.
   - Empfehlung: Aggregatzeile ergänzen (CLI + CSV).

6) Zahl-/Währungsformat konfigurierbar: Anforderungen nennen konfigurierbare DE-Formatierung. Implementierung ist fest auf DE gestellt, `settings.locale` wird nicht verwendet.
   - Empfehlung: Entweder Locale-Flag entfernen (Dokumentation anpassen) oder einfache Umschaltung (DE/EN) implementieren.

7) Export-Flag: `--export` ist optional/ignoriert, da nun immer CSV gespeichert wird.
   - Empfehlung: Doku/Help-Text konsistent halten (bereits als „ignoriert“ markiert), langfristig Flag entfernen oder sinnvoll nutzen (z. B. json/md).

8) Module „audit“: In der Arc42-Bausteinsicht als optional erwähnt, aber nicht vorhanden – ok. Ggf. als „Future“ im Dokument kennzeichnen.

9) Python-Holidays Offline: Abhängigkeit ist ok, aber Anforderungen nennen „offline“. Paket ist lokal ok; sicherstellen, dass keine Online-Abfragen nötig sind (ist der Fall).

## Kleinere Anmerkungen
- Runden: „round half up“ ist implementiert (floor(q+0.5)), funktioniert für positive Werte – ausreichend, da negative Anforderungen nicht vorkommen.
- CSV-Format: Semikolon-getrennt, DE-Dezimal – entspricht Manual; optional konfigurierbar wäre nice-to-have.

## Empfohlene Änderungen (priorisiert)
1. As-Of anwenden (kleiner Fix im CLI/Config-Fluss).
2. Feiertage-API robust (subdiv/prov Fallback + kleiner Test).
3. Warnungen sammeln/ausgeben (ignorierte Projekte, Ziele unerreichbar bei zu geringer ØKap/Tag > Øh/Tag).
4. Util 90/80 ergänzen + Gesamtzeile (CLI/CSV).
5. Doku nachziehen: Locale-Flag entweder entfernen oder Simple-Switch implementieren.

## Checkliste – Erfüllung (Auszug)
- FR-01/02/03/05/06/07: weitgehend erfüllt.
- FR-04: erfüllt (100/90/80, Auslastung, Umsatz) – Auslastung nur 100% in Darstellung → Teilerfüllung.
- NFR: Performance/Portabilität/Fehlermeldungen soweit ok; Audit optional noch offen.

— Reviewer-Agent, 2025-08-25
